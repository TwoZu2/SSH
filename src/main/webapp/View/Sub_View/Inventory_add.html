<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>layui</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <script src="../../resources/layui/jquery-3.1.1.min.js"></script>
    <link rel="stylesheet" href="../../resources/layui/css/layui.css" media="all">
    <script src="../../resources/layui/layui.js" charset="utf-8"></script>

    <title>添加记录</title>
<!--    <script>-->

<!--        layer.msg("tianjiajilu")-->
<!--    </script>-->

    <style>
        .layui-form-label {
            width: 100px;
        }

        .layui-input-block {
            margin-left: 130px;
            min-height: 36px;
            width: 80%
        }
    </style>


</head>
<body class="body">
<fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
    <legend>添加记录</legend>
</fieldset>

<form class="layui-form layui-from-pane" style="margin-top:20px">
    <div class="layui-form-item">
        <label class="layui-form-label">配件名称</label>
        <div class="layui-input-block">
            <div class="layui-form">
                <select name="ityName" id="select" lay-filter="ssss">

                </select>
            </div>
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">配件数量</label>
        <div class="layui-input-block">
            <input type="text" value="" name="ityNumber" id="ItyNumber" required lay-verify="required"
                   autocomplete="off" placeholder="请输入配件数量" class="layui-input">
            <span style="display: none;border: 0" id="t1"><label style="color: red">请输入数字</label></span>
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">品牌</label>
        <div class="layui-input-block">
            <input type="text" value="" name="ityBrand" id="ItyBrand" required lay-verify="required" autocomplete="off"
                   placeholder="请输入品牌" class="layui-input">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">进价</label>
        <div class="layui-input-block">
            <input type="text" value="" name="purchasePrice" id="PurchasePrice" required lay-verify="required"
                   autocomplete="off" placeholder="请输入进价" class="layui-input">
            <span style="display: none;border: 0" id="t2"><label style="color: red">请输入数字</label></span>
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label">车型</label>
        <div class="layui-input-block">
            <input type="text" value="" name="ityModels" id="ItyModels" required lay-verify="required"
                   autocomplete="off" placeholder="请输入车型" class="layui-input">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">配件型号</label>
        <div class="layui-input-block">
            <input type="text" value="" name="ityType" id="ItyType" required lay-verify="required" autocomplete="off"
                   placeholder="请输入配件型号" class="layui-input">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">售价</label>
        <div class="layui-input-block">
            <input type="text" value="" name="outPrice" id="OutPrice" required lay-verify="required" autocomplete="off"
                   placeholder="请输入售价" class="layui-input">
            <span style="display: none;border: 0" id="t3"><label style="color: red">请输入数字</label></span>
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">作用</label>
        <div class="layui-input-block">
            <input type="text" value="" name="ityRole" id="ItyRole" required lay-verify="required" autocomplete="off"
                   placeholder="请输入用途" class="layui-input">
        </div>
    </div>
    <div class="layui-form-item" style="margin-top:40px">
        <div class="layui-input-block">
            <button class="layui-btn  layui-btn-submit " lay-submit="" lay-filter="demo1">立即提交</button>
            <button type="reset" class="layui-btn layui-btn-primary">重置</button>
        </div>
    </div>
</form>

<script type="text/javascript">

    $("#ItyNumber").keyup(function () {
        var c = $(this);
        if (/[^\d]/.test(c.val())) {
            var temp = c.val().replace(/[^\d]/g, '');
            $(this).val(temp);
            $("#t1").css({'display': 'block'});
        } else {
            $("#t1").css({'display': 'none'});
        }
    })
    $("#PurchasePrice").keyup(function () {
        var c = $(this);
        if (/[^\d]/.test(c.val())) {
            var temp = c.val().replace(/[^\d]/g, '');
            $(this).val(temp);
            $("#t2").css({'display': 'block'});
        } else {
            $("#t2").css({'display': 'none'});
        }
    })
    $("#OutPrice").keyup(function () {
        var c = $(this);
        if (/[^\d]/.test(c.val())) {
            var temp = c.val().replace(/[^\d]/g, '');
            $(this).val(temp);
            $("#t3").css({'display': 'block'});
        } else {
            $("#t3").css({'display': 'none'});
        }
    })

</script>

<script>

    layui.use('form', function () {

        var form = layui.form;
        getClassify();


        function getClassify() {
            $.ajax({
                url: '../../Storages_findAll',
                type: "post",
                dataType:"json",
                async: true,

                error: function () {
                },

                data: {"page": 1, "limit": 99999},
                success: function (data) {

                    var html='';
                    $.each(data.data, function (idx, obj) {
                        var option=html+"<option value='" + obj.stoName + "' name='" + obj.stoId + "' >" + obj.stoName + "</option>";
                        $("#select").append(option);
                    });

                    layui.form.render("select");

                }

            });

        }

        //监听提交
        form.on('submit(demo1)', function (data) {

            // $.ajax({
            //     url: "../../Servletdpadd",    // 提交到controller的url路径
            //     type: "post",    // 提交方式
            //     data: {"name": name, "num": num,"text":text},  // data为String类型，必须为 Key/Value 格式。
            //        // 服务器端返回的数据类型
            //
            //         success: function (data) {
            //             // 请求成功后的回调函数，其中的参数data为controller返回的map,也就是说,@ResponseBody将返回的map转化为JSON格式的数据，然后通过data这个参数取JSON数据中的值
            //             if(data==="1"){
            //                 layer.msg("成功",{icon: 1, time: 1500}, function () {
            //
            //                     layer.close(index);
            //                     $(".layui-laypage-btn").click();//点击分页刷新当前页
            //                 });
            //             }else {
            //                 layer.alert("请先删除部门", {icon: 2,time:1500}, function () {
            //                     layer.close(index);
            //                     $(".layui-laypage-btn").click();
            //                      window.location.reload();  刷新父窗口
            //                 });
            //             }
            //         }
            // });


            $.ajax({


                url: "../../Inventory_add",   // 提交到controller的url路径
                type: "post",    // 提交方式
                data: {
                    "ityName": data.field.ityName,
                    "ityNumber": data.field.ityNumber,
                    "ityBrand": data.field.ityBrand,
                    "purchasePrice": data.field.purchasePrice,
                    "ityModels": data.field.ityModels,
                    "ityType": data.field.ityType,
                    "outPrice": data.field.outPrice,
                    "ityRole": data.field.ityRole
                }, // data为String类型，必须为 Key/Value 格式。
                // 服务器端返回的数据类型
                async: false,
                success: function (data) {
                    //alert(data)
                    if (data.msg === "1") {
                        parent.layer.msg("添加成功", {icon: 1, time: 1000}, function () {

                            $(".layui-laypage-btn").click();
                            window.parent.location.reload();  //刷新父窗口
                            parent.layer.closeAll();
                        });


                    }

                }

            });

        })
        return false;
    });
</script>

</body>
</html>
